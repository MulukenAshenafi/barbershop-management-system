<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Signing in…</title>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-size: 16px;
      line-height: 1.5;
      color: #1a1a2e;
      background: #f8f9fa;
      padding: 24px;
      text-align: center;
    }
    .box {
      max-width: 400px;
      background: #fff;
      padding: 32px;
      border-radius: 12px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.08);
    }
    h1 { font-size: 1.25rem; margin: 0 0 12px; font-weight: 600; }
    p { margin: 0 0 16px; color: #495057; }
    .open-app {
      display: inline-block;
      margin-top: 8px;
      padding: 12px 24px;
      background: #1a1a2e;
      color: #fff;
      text-decoration: none;
      border-radius: 8px;
      font-weight: 500;
    }
    .open-app:hover { opacity: 0.9; }
    code { font-size: 0.85em; background: #f1f3f4; padding: 2px 6px; border-radius: 4px; }
  </style>
</head>
<body>
  <div class="box">
    <h1>Signing you in</h1>
    <p id="msg">Opening the BarberBook app…</p>
    <p id="desktop-msg" style="display:none;">Open this link on the <strong>same phone</strong> where you requested the sign-in email, so the BarberBook app can complete sign-in.</p>
    <a href="#" id="open-app" class="open-app" style="display:none;">Open in app</a>
    <p id="hint" style="display:none; font-size: 0.875rem; color: #6c757d; margin-top: 16px;">If nothing happens, you may be using Expo Go. Build and install the app (e.g. <code>eas build</code>) so the link can open it.</p>
  </div>
  <script>
    (function() {
      var q = window.location.search || '';
      var appUrl = 'barberbook://email-signin' + q;
      var isAndroid = /Android/i.test(navigator.userAgent);
      var isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
      var openLink = document.getElementById('open-app');

      // Chrome only opens the app on user gesture (tap). Use intent URL on Android for better reliability.
      if (isAndroid && q) {
        openLink.href = 'intent://email-signin' + q + '#Intent;scheme=barberbook;end';
      } else {
        openLink.href = appUrl;
      }

      if (isMobile) {
        // Show button immediately – auto-redirect is often blocked by Chrome (no user gesture)
        openLink.style.display = 'inline-block';
        document.getElementById('msg').textContent = 'Tap the button below to open the BarberBook app and complete sign-in.';
        document.getElementById('hint').style.display = 'block';
      } else {
        document.getElementById('msg').style.display = 'none';
        document.getElementById('desktop-msg').style.display = 'block';
        openLink.style.display = 'inline-block';
        openLink.textContent = 'Copy link for your phone';
        openLink.href = '#';
        openLink.onclick = function(e) {
          e.preventDefault();
          window.prompt('Copy this URL and open it in your phone\'s browser (or email it to yourself):', window.location.href);
        };
      }
    })();
  </script>
</body>
</html>
